<!DOCTYPE html><html lang="en"><head><title>matrix</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="matrix"><meta name="groc-project-path" content="js/src/matrix.js"><meta name="groc-github-url" content="https://github.com/aureooms/js-fibonacci"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/aureooms/js-fibonacci/blob/master/js/src/matrix.js">js/src/matrix.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> __matrix__ = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( zero , one , mul , add )</span> {</span>

	<span class="hljs-keyword">var</span> matrix = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( n )</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We can compute simultaneously,
      a   =      b
      b   =  a + b
Using matrix multiplication,
      X        M
      :        :
    | a |   | 0 1 |
    | b | . | 1 1 |
With this we can compute F<em>{n-1} and F_n using matrix exponentiation
                                   n
    | F</em>{n-1} |     | 0 |   | 0 1 |
    |   F_n   |  =  | 1 | . | 1 1 |
Matrix exponentiation can be achieved in log n steps using the
binary decomposition of n
    n = ( n % 2 ) <em> 1 + ( ( n &gt;&gt; 1 ) % 2 ) </em> 2 + ... + ( ( n &gt;&gt; i ) % 2 ) * ( i + 1 ) + ...
And computing M raised to successive powers of 2,
                              2
           n     /     (n//2) \           (n%2)
    | 0 1 |     |  | 0 1 |     |      | 0 1 |
    | 1 1 |  =   \ | 1 1 |    /   .   | 1 1 |
The matrix is encoded as
    | t u |
    | v w |</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">var</span> a , b , t , u , v , w , a2 , b2 , t2 , u2 , v2 , w2 ;

		a = zero( ) ; b = one( ) ;
		t = zero( ) ; u = one( ) ; v = one( ) ; w = one( ) ;

		<span class="hljs-keyword">while</span> ( <span class="hljs-literal">true</span> ) {

			<span class="hljs-keyword">if</span> ( n % <span class="hljs-number">2</span> === <span class="hljs-number">1</span> ) {

				a2 = add( mul( a , t ) , mul( b , u ) ) ;
				b2 = add( mul( a , v ) , mul( b , w ) ) ;

				a = a2 ; b = b2 ;

				<span class="hljs-keyword">if</span> ( n === <span class="hljs-number">1</span> ) <span class="hljs-keyword">break</span> ;

			}


			t2 = add( mul( t , t ) , mul( u , v ) ) ;
			u2 = add( mul( t , u ) , mul( u , w ) ) ;
			v2 = add( mul( v , t ) , mul( w , v ) ) ;
			w2 = add( mul( v , u ) , mul( w , w ) ) ;

			t = t2 ; u = u2 ; v = v2 ; w = w2 ;

			n &gt;&gt;&gt;= <span class="hljs-number">1</span> ;

		}

		<span class="hljs-keyword">return</span> [ a , b ] ;

	} ;

	<span class="hljs-keyword">return</span> matrix ;

} ;

exports.__matrix__ = __matrix__ ;</div></div></div></div></body></html>